{% load static socialaccount account i18n %} {% include 'chat/chat_panel.html' %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="static/img/favicon.ico">
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/news.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    {% block extra_css %}{% endblock %}
    <style>
      /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —á–∞—Ç–∞ */
      .chat-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: rgb(207, 142, 0);
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9998;
        transition: transform 0.2s ease;
        font-size: 25px;
      }

      .chat-button:hover {
        transform: scale(1.1);
        background-color: rgb(255, 196, 0);
      }

      .chat-button i {
        font-size: 24px;
      }

      /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ —á–∞—Ç–∞ */
      .chat-panel {
        position: fixed;
        bottom: 90px; /* –£–≤–µ–ª–∏—á–∏–ª–∏ –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É */
        right: 20px;
        width: 300px;
        height: 400px;
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
      }

      /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
      @media (max-width: 768px) {
        .chat-button {
          width: 50px;
          height: 50px;
          bottom: 20px;
          left:350px;
        }

        .chat-panel {
          bottom: 70px;
          right: 10px;
        }
      }
    </style>
    <title>–ê–≤—Ç–æ–¢–µ—Ö–¶–µ–Ω—Ç—Ä –î–æ–º–æ–¥–µ–¥–æ–≤–æ</title>
  </head>
  <body>
    <header>
      <div class="logo-container">
        <a href="{% url 'home' %}">
          <img
            src="{% static 'img/logo.jpg' %}"
            class="imglogo"
            alt="–õ–æ–≥–æ—Ç–∏–ø"
          />
        </a>
        <button class="mobile-menu-btn">‚ò∞</button>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            const mobileMenuBtn = document.querySelector(".mobile-menu-btn");
            const nav = document.querySelector("nav");

            mobileMenuBtn.addEventListener("click", function () {
                nav.classList.toggle("active");

                // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏ –º–µ–Ω—é
                if (nav.classList.contains("active")) {
                    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
                    this.style.transform = "translateY(-50%) rotate(180deg)";
                    this.textContent = "‚úï";
                } else {
                    // –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è
                    this.style.transform = "translateY(-50%) rotate(0deg)";
                    this.textContent = "‚ò∞";
                }
            });

            // –ó–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É–Ω–∫—Ç –º–µ–Ω—é
            document.querySelectorAll(".links-container a").forEach((link) => {
                link.addEventListener("click", () => {
                    nav.classList.remove("active");
                    mobileMenuBtn.style.transform = "translateY(-50%) rotate(0deg)";
                    mobileMenuBtn.textContent = "‚ò∞";
                });
            });
        });
        </script>
      </div>

      <nav>
        <div class="links-container">
          <ul>
            <li><a href="{% url 'home' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="{% url 'home' %}#onas">–û –Ω–∞—Å</a></li>
            <li><a href="{% url 'home' %}#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
            <li>
              <div class="dropdown">
                <a href="{% url 'services' %}" class="dropbtn">–£—Å–ª—É–≥–∏</a>
                <div class="dropdown-content">
                  <button class="dropbtn-right">
                    <a href="{% url 'services_category' '–†–µ–º–æ–Ω—Ç' %}"
                      >–í—Å–µ —É—Å–ª—É–≥–∏ —Ä–µ–º–æ–Ω—Ç–∞</a
                    >
                  </button>
                  <div class="dropdown-content">
                    <a href="{% url 'services_category' '–†–µ–º–æ–Ω—Ç' %}"
                      >–í—Å–µ —É—Å–ª—É–≥–∏ —Ä–µ–º–æ–Ω—Ç–∞</a
                    >
                    <a href="{% url 'services_category' '–†–µ–º–æ–Ω—Ç' %}#auto"
                      >–†–µ–º–æ–Ω—Ç –∞–≤—Ç–æ</a
                    >
                    <a href="{% url 'services_category' '–†–µ–º–æ–Ω—Ç' %}#tires"
                      >–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂</a
                    >
                    <a href="{% url 'services_category' '–†–µ–º–æ–Ω—Ç' %}#ac"
                      >–ó–∞–ø—Ä–∞–≤–∫–∞ –∏ —Ä–µ–º–æ–Ω—Ç –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–∞</a
                    >
                  </div>

                  <button class="dropbtn-right">
                    <a href="{% url 'services_category' '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞' %}"
                      >–í—Å–µ —É—Å–ª—É–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</a
                    >
                  </button>
                  <div class="dropdown-content">
                    <a href="{% url 'services_category' '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞' %}#check"
                      >–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</a
                    >
                    <a
                      href="{% url 'services_category' '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞' %}#complex"
                      >–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</a
                    >
                    <a
                      href="{% url 'services_category' '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞' %}#evaluation"
                      >–û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è</a
                    >
                  </div>

                  <button class="dropbtn-right">
                    <a href="{% url 'services_category' '–¢–û' %}"
                      >–í—Å–µ —É—Å–ª—É–≥–∏ –¢–û</a
                    >
                  </button>
                  <div class="dropdown-content">
                    <a href="{% url 'services_category' '–¢–û' %}#wash">–ú–æ–π–∫–∞</a>
                    <a href="{% url 'services_category' '–¢–û' %}#dents"
                      >–£–¥–∞–ª–µ–Ω–∏–µ –≤–º—è—Ç–∏–Ω</a
                    >
                    <a href="{% url 'services_category' '–¢–û' %}#inspection"
                      >–¢–µ—Ö–æ—Å–º–æ—Ç—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</a
                    >
                    <a href="{% url 'services_category' '–¢–û' %}#paint"
                      >–ü–æ–∫—Ä–∞—Å–∫–∞</a
                    >
                    <a href="{% url 'services_category' '–¢–û' %}#polish"
                      >–ü–æ–ª–∏—Ä–æ–≤–∫–∞</a
                    >
                  </div>
                </div>
              </div>
            </li>

            {% if user.is_authenticated %}
            {% if user.is_superuser %}
                <li>
                    <div class="dropdown">
                        <a href="#" class="dropbtn">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
                        <div class="dropdown-content">
                            <a href="{% url 'admin:index' %}">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                            <a href="{% url 'manage_news' %}">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</a>
                            <a href="{% url 'manage_special_offers' %}">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏—è–º–∏</a>
                            <a href="{% url 'chat:chat' %}">
                                –ß–∞—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                                {% if support_unread_count > 0 %}
                                    <span class="badge bg-danger">{{ support_unread_count }}</span>
                                {% endif %}
                            </a>
                        </div>
                    </div>
                </li>
            {% elif is_support_user %}
                <li>
                    <a href="{% url 'chat:chat' %}" >
                        –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                        {% if support_unread_count > 0 %}
                            <span class="badge bg-danger">{{ support_unread_count }}</span>
                        {% endif %}
                    </a>
                </li>
            {% endif %}
            <li><a href="{% url 'profile' %}">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
        {% else %}
            <li><a href="{% url 'login' %}">–í–æ–π—Ç–∏</a></li>
        {% endif %}
          </ul>
        </div>
        <p class="adres">–†–æ—Å—Å–∏—è, –≥.–ò–∂–µ–≤—Å–∫, —É–ª.–ê–≤—Ç–æ–∑–æ–≤–æ–¥—Å–∫–∞—è 30</p>
      </nav>
      {% if user.is_authenticated and not is_support_user %}
    <div class="header-chat">
        <button id="chatToggleBtn" class="chat-button">
            <span class="chat-icon">üí¨</span>
        </button>
    </div>
{% endif %}
    </header>
    {% block content %} {% endblock %} {% include 'footer.html' %}
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // –ù–∞–π–¥–µ–º –≤—Å–µ –Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
      const chatToggleBtn = document.getElementById("chatToggleBtn");
      const chatPanel = document.getElementById("chatPanel");
      const chatMessages = document.getElementById("chatMessages");

      console.log("Chat button:", chatToggleBtn); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
      console.log("Chat panel:", chatPanel); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ —á–∞—Ç–∞
      if (chatToggleBtn) {
        chatToggleBtn.addEventListener("click", function (e) {
          e.preventDefault();
          console.log("Button clicked"); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏

          if (chatPanel) {
            // –ï—Å–ª–∏ —á–∞—Ç —Å–∫—Ä—ã—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
            if (
              chatPanel.style.display === "none" ||
              !chatPanel.style.display
            ) {
              chatPanel.style.display = "flex";
              if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
              }
            } else {
              // –ï—Å–ª–∏ —á–∞—Ç –ø–æ–∫–∞–∑–∞–Ω - —Å–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
              chatPanel.style.display = "none";
            }
          } else {
            console.log("Chat panel not found!");
          }
        });
      }

      // –û—Å—Ç–∞–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è date input
      const dateInput = document.querySelector('input[type="date"]');
      const timeSelect = document.querySelector('select[name="time"]');

      if (dateInput && timeSelect) {
        dateInput.addEventListener("change", function () {
          const selectedDate = this.value;
          fetch(`?date=${selectedDate}`)
            .then((response) => response.text())
            .then((html) => {
              const temp = document.createElement("div");
              temp.innerHTML = html;
              const newTimeSelect = temp.querySelector('select[name="time"]');
              if (newTimeSelect) {
                timeSelect.innerHTML = newTimeSelect.innerHTML;
              }
            });
        });
      }
    });
  </script>
</html>
